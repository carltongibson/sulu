define([],function(){"use strict";var a={instanceName:null,urlGet:null,idsParameter:"ids",preselected:[],idKey:"id",titleKey:"title",resultKey:"snippets",urlAll:null,language:null,snippetType:null,webspace:null,uniqueSnippets:!0,translations:{noSnippetsSelected:"snippet-content.nosnippets-selected",addSnippets:"snippet-content.add"}},b={skeleton:function(a){return['<div class="white-box form-element" id="',a.ids.container,'">','   <div class="header">','       <span class="fa-plus-circle icon left action" id="',a.ids.addButton,'"></span>','       <span class="fa-cog icon right border " id="',a.ids.configButton,'" style="display: none;"></span>',"   </div>",'   <div class="content" id="',a.ids.content,'"></div>',"</div>"].join("")},noContent:function(a){return['<div class="no-content">','   <span class="fa-coffee icon"></span>','   <div class="text">',a,"</div>","</div>"].join("")},data:function(a){return['<div id="',a.ids.snippetList,'"/>'].join("")},contentItem:function(a,b,c){return['<li data-id="',a,'">','   <span class="num">',b,"</span>",'   <span class="value">',c,"</span>",'   <span class="fa-times remove"></span>',"</li>"].join("")}},c=function(a){return"#"+this.options.ids[a]},d=function(){if(this.options.ids={container:"snippet-content-"+this.options.instanceName+"-container",addButton:"snippet-content-"+this.options.instanceName+"-add",configButton:"snippet-content-"+this.options.instanceName+"-config",content:"snippet-content-"+this.options.instanceName+"-content",snippetList:"snippet-content-"+this.options.instanceName+"-column-navigation"},this.sandbox.dom.html(this.$el,b.skeleton(this.options)),this.$container=this.sandbox.dom.find(c.call(this,"container"),this.$el),this.$content=this.sandbox.dom.find(c.call(this,"content"),this.$el),this.$addButton=this.sandbox.dom.find(c.call(this,"addButton"),this.$el),this.$configButton=this.sandbox.dom.find(c.call(this,"configButton"),this.$el),this.sandbox.dom.data(this.$el,"snippet-ids")){var a=this.sandbox.dom.data(this.$el,"snippet-ids");this.data.ids=a}e.call(this),f.call(this),this.URIGet={str:"",hasChanged:!1},this.URIGetAll={str:"",hasChanged:!1},t.call(this),u.call(this),v.call(this),n.call(this),r.call(this),j.call(this)},e=function(){var a=this.sandbox.translate(this.options.translations.noSnippetsSelected);this.sandbox.dom.html(this.$content,b.noContent(a))},f=function(){this.sandbox.on("husky.overlay.snippet-content."+this.options.instanceName+".add.initialized",i.bind(this)),this.sandbox.dom.on(c.call(this,"content"),"click",g.bind(this),"li .remove"),this.sandbox.on("husky.datagrid.initialized",function(){this.sandbox.emit("husky.overlay.snippet-content."+this.options.instanceName+".add.set-position")}.bind(this))},g=function(a){var b=this.sandbox.dom.parents(a.currentTarget,"li"),c=this.sandbox.dom.data(b,"id");this.sandbox.dom.remove(b),this.data.ids.splice(this.data.ids.indexOf(c),1),h.call(this,c),q.call(this),0===this.items.length?e.call(this):m.call(this),this.sandbox.emit("husky.column-navigation."+this.options.instanceName+".unmark",c),this.sandbox.emit("sulu.content.changed")},h=function(a){for(var b=-1,c=this.items.length;++b<c;)if(a===this.items[b].id)return this.items.splice(b,1),!0;return!1},i=function(){this.sandbox.start([{name:"datagrid@husky",options:{url:this.URIGetAll.str,preselected:this.data.ids,pagination:!1,resultKey:this.options.resultKey,sortable:!1,columnOptionsInstanceName:"",el:c.call(this,"snippetList"),viewOptions:{table:{selectItem:{type:"checkbox"},removeRow:!1,editable:!1,validation:!1,addRowTop:!1,showHead:!0,contentContainer:"#content",highlightSelected:!0}},matchings:[{content:"Title",width:"100%",name:"title",editable:!0,sortable:!0,type:"title",validation:{required:!1}}]}}])},j=function(){this.sandbox.dom.on(this.$el,"click",g.bind(this),".-list .remove")},k=function(){0!==this.items.length?(this.linkList=this.sandbox.dom.createElement('<ul class="items-list"/>'),this.sandbox.util.each(this.items,function(a){l.call(this,this.items[a],this.linkList)}.bind(this)),this.sandbox.dom.html(this.$content,this.linkList),m.call(this)):(e.call(this),q.call(this))},l=function(a,c){this.sandbox.dom.append(c,b.contentItem(a[this.options.idKey],this.sandbox.dom.find("li",c).length+1,a[this.options.titleKey]))},m=function(){this.itemsVisible=this.items.length<this.itemsVisible?this.items.length:this.itemsVisible,(null===this.$footer||void 0===this.$footer)&&(this.$footer=this.sandbox.dom.createElement('<div class="footer"/>')),this.sandbox.dom.append(this.$container,this.$footer)},n=function(){var a=this.sandbox.dom.createElement("<div/>");this.sandbox.dom.append(this.$el,a),this.sandbox.start([{name:"overlay@husky",options:{triggerEl:this.$addButton,cssClass:"snippet-content-overlay",el:a,removeOnClose:!1,container:this.$el,instanceName:"snippet-content."+this.options.instanceName+".add",skin:"wide",slides:[{title:this.sandbox.translate(this.options.translations.addSnippets),cssClass:"snippet-content-overlay-add",data:b.data(this.options),okCallback:o.bind(this)}]}}])},o=function(){this.sandbox.emit("husky.datagrid.items.get-selected",function(a){this.data.ids=a,s.call(this,this.data),t.call(this),r.call(this),this.sandbox.emit("sulu.content.changed")}.bind(this))},p=function(){q.call(this);var a=this.sandbox.dom.createElement('<div class="loader"/>');this.sandbox.dom.html(this.$content,a),this.sandbox.start([{name:"loader@husky",options:{el:a,size:"100px",color:"#e4e4e4"}}])},q=function(){null!==this.$footer&&this.sandbox.dom.remove(this.$footer)},r=function(){if(this.URIGet.hasChanged===!0){var a=function(a){if(void 0==a._embedded.snippets)throw"Invalid response from server, expected to find _embedded.snippets";this.items=a._embedded.snippets,k.call(this)}.bind(this);p.call(this),this.data.ids&&this.data.ids.length>0?this.sandbox.util.load(this.URIGet.str).then(a.bind(this)).fail(function(a){this.sandbox.logger.log(a)}.bind(this)):a.call(this,{_embedded:{snippets:[]}})}},s=function(){this.sandbox.dom.data(this.$el,"snippet-ids",this.data.ids)},t=function(){var a=[this.options.urlGet,"?ids=",(this.data.ids||[]).join(","),"&language=",this.options.language].join("");a!==this.URIGet.str?(this.URIGet.str=a,this.URIGet.hasChanged=!0):this.URIGet.hasChanged=!1},u=function(){var a=[this.options.urlAll,"?language=",this.options.language,"&type=",this.options.snippetType].join("");a!==this.URIGetAll.str?(this.URIGetAll.str=a,this.URIGetAll.hasChanged=!0):this.URIGetAll.hasChanged=!1},v=function(){this.sandbox.dom.val(c.call(this,"displayOption"),this.data.displayOption)};return{initialize:function(){this.options=this.sandbox.util.extend({},a,this.options),this.data={ids:[]},this.linkList=null,this.sandbox.util.each(["snippetType","language","webspace","urlGet","urlAll"],function(a){if(null===this.options[a])throw'you must specify the "'+a+'" option'}.bind(this)),d.call(this)}}});